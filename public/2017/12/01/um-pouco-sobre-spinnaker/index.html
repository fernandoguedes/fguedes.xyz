<!doctype html><html class="not-ready lg:text-base" style=--bg:#faf8f1 lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Um pouco sobre o Spinnaker - Abstraindo as complexidades da entrega contínua - Luís Fernando Guedes</title><meta name=theme-color><meta name=description content="Olá, vão fazer três meses que entrei na Portal Telemedicina, e uma das minhas missões iniciais era tornar ágil o processo de entrega de software, basicamente fazer funcionar o fluxo de ponta a ponta - do desenvolvimento ao deploy - com o processo todo automatizado, sem a necessidade de trabalhos manuais para a entrega em diferentes ambientes.
Em janeiro desse ano (2017) a Portal participou de uma seleção mundial do programa Launchpad Accelerator e teve a oportunidade de contar com o expertise da Google, fez treinamentos, foi acelerada financeiramente e através de créditos em produtos e seviços, em meio a essa troca de experiências e conhecimento, o nosso CEO Rafael Figueroa, conheceu o Spinnaker, compartilhou comigo e disse que poderia ser nosso forte aliado na automação de todo esse processo."><meta name=author content="Luís Fernando Guedes"><link rel="preload stylesheet" as=style href=http://fguedes.xyz/fguedes.xyz/main.min.css><script defer src=http://fguedes.xyz/fguedes.xyz/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=http://fguedes.xyz/fguedes.xyz/theme.png><link rel=preload as=image href="https://www.gravatar.com/avatar/8d8101b71c2e1dce49eafcd05f9777f4?s=160&amp;d=identicon"><link rel=preload as=image href=http://fguedes.xyz/fguedes.xyz/github.svg><link rel=preload as=image href=http://fguedes.xyz/fguedes.xyz/linkedin.svg><link rel=icon href=http://fguedes.xyz/fguedes.xyz/favicon.ico><link rel=apple-touch-icon href=http://fguedes.xyz/fguedes.xyz/apple-touch-icon.png><meta name=generator content="Hugo 0.117.0"><meta itemprop=name content="Um pouco sobre o Spinnaker - Abstraindo as complexidades da entrega contínua"><meta itemprop=description content="Olá, vão fazer três meses que entrei na Portal Telemedicina, e uma das minhas missões iniciais era tornar ágil o processo de entrega de software, basicamente fazer funcionar o fluxo de ponta a ponta - do desenvolvimento ao deploy - com o processo todo automatizado, sem a necessidade de trabalhos manuais para a entrega em diferentes ambientes.
Em janeiro desse ano (2017) a Portal participou de uma seleção mundial do programa Launchpad Accelerator e teve a oportunidade de contar com o expertise da Google, fez treinamentos, foi acelerada financeiramente e através de créditos em produtos e seviços, em meio a essa troca de experiências e conhecimento, o nosso CEO Rafael Figueroa, conheceu o Spinnaker, compartilhou comigo e disse que poderia ser nosso forte aliado na automação de todo esse processo."><meta itemprop=datePublished content="2017-12-01T00:00:00+00:00"><meta itemprop=dateModified content="2017-12-01T00:00:00+00:00"><meta itemprop=wordCount content="748"><meta itemprop=keywords content="Integração Contínua,Deploy Contínuo,spinnaker,docker,kubernetes,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Um pouco sobre o Spinnaker - Abstraindo as complexidades da entrega contínua"><meta name=twitter:description content="Olá, vão fazer três meses que entrei na Portal Telemedicina, e uma das minhas missões iniciais era tornar ágil o processo de entrega de software, basicamente fazer funcionar o fluxo de ponta a ponta - do desenvolvimento ao deploy - com o processo todo automatizado, sem a necessidade de trabalhos manuais para a entrega em diferentes ambientes.
Em janeiro desse ano (2017) a Portal participou de uma seleção mundial do programa Launchpad Accelerator e teve a oportunidade de contar com o expertise da Google, fez treinamentos, foi acelerada financeiramente e através de créditos em produtos e seviços, em meio a essa troca de experiências e conhecimento, o nosso CEO Rafael Figueroa, conheceu o Spinnaker, compartilhou comigo e disse que poderia ser nosso forte aliado na automação de todo esse processo."></head><body class="text-black duration-200 ease-out dark:text-white"><header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center"><div class="relative z-50 mr-auto flex items-center"><a class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold" href=http://fguedes.xyz/fguedes.xyz/>Luís Fernando Guedes</a><div class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]" role=button aria-label=Dark></div></div><div class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden" role=button aria-label=Menu></div><script>const htmlClass=document.documentElement.classList;setTimeout(()=>{htmlClass.remove("not-ready")},10);const btnMenu=document.querySelector(".btn-menu");btnMenu.addEventListener("click",()=>{htmlClass.toggle("open")});const metaTheme=document.querySelector('meta[name="theme-color"]'),lightBg="#faf8f1".replace(/"/g,""),setDark=e=>{metaTheme.setAttribute("content",e?"#000":lightBg),htmlClass[e?"add":"remove"]("dark"),localStorage.setItem("dark",e)},darkScheme=window.matchMedia("(prefers-color-scheme: dark)");if(htmlClass.contains("dark"))setDark(!0);else{const e=localStorage.getItem("dark");setDark(e?e==="true":darkScheme.matches)}darkScheme.addEventListener("change",e=>{setDark(e.matches)});const btnDark=document.querySelector(".btn-dark");btnDark.addEventListener("click",()=>{setDark(localStorage.getItem("dark")!=="true")})</script><div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"><nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6"><a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/fguedes.xyz/about/>About</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/fguedes.xyz/contact/>Contact</a></nav><nav class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"><a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/fernandoguedes target=_blank rel=me>github</a>
<a class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./linkedin.svg) href=https://linkedin.com/in/nan.xiaobei target=_blank rel=me>linkedin</a></nav></div></header><main class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"><article><header class=mb-16><h1 class="!my-0 pb-2.5">Um pouco sobre o Spinnaker - Abstraindo as complexidades da entrega contínua</h1><div class="text-sm antialiased opacity-60"><time>Dec 1, 2017</time>
<span class=mx-1>&#183;</span>
<span>Luís Fernando Guedes</span></div></header><section><p>Olá, vão fazer três meses que entrei na <a href=http://portaltelemedicina.com.br/>Portal Telemedicina</a>, e uma das minhas missões iniciais era tornar ágil o processo de entrega de software, basicamente fazer funcionar o fluxo de ponta a ponta - do desenvolvimento ao deploy - com o processo todo automatizado, sem a necessidade de trabalhos manuais para a entrega em diferentes ambientes.</p><p>Em janeiro desse ano (2017) a Portal participou de uma seleção mundial do programa <a href=http://portaltelemedicina.com.br/portal-telemedicina-acelerada-google/>Launchpad Accelerator</a> e teve a oportunidade de contar com o expertise da Google, fez treinamentos, foi acelerada financeiramente e através de créditos em produtos e seviços, em meio a essa troca de experiências e conhecimento, o nosso CEO Rafael Figueroa, conheceu o <a href=https://spinnaker.io>Spinnaker</a>, compartilhou comigo e disse que poderia ser nosso forte aliado na automação de todo esse processo.</p><h2 id=história>História</h2><p>O Spinnaker foi criado para satisfazer as necessidades internas de deploy e gerenciamento de infraestrutura da Netflix, e desde 2014 vinha sendo utilizado, efetuando mais de 3000 deploys/dia em 1000 microsserviços (!). Com a ferramenta em pleno funcionamento, em parceria com o Google a tornaram open-source em outubro de 2015, e desde então, vem ganhando o mundo.</p><h2 id=composição>Composição</h2><blockquote><p>Spinnaker is an open source, multi-cloud continuous delivery platform that helps you release software changes with high velocity and confidence.</p></blockquote><p>A ferramenta é um conjunto de microsserviços e drivers que se integram a diferentes <em>cloud providers</em> e oferece diferentes estratégias de deploy - do red/black (blue/green) ao canary - abstraindo a complexidade do controle e gerenciamento da infraestrutura necessária para que esse processo seja ágil e funcione da maneira correta.</p><h3 id=microsserviços>Microsserviços</h3><p>O Spinnaker é composto por 10 microsserviços entre APIs, frontends, integrações e persistência de dados, abaixo cada uma e responsabilidades:</p><p><img src=/spinnaker/architeture.png alt="Arquitetura do Spinnaker"></p><ul><li><a href=https://github.com/spinnaker/deck>Deck</a>: Interface web para gerenciamento e acompanhamento de todas as execuções background da ferramenta;</li><li><a href=https://github.com/spinnaker/gate>Gate</a>: Gateway de APIs, responsável pela distribuição de requests aos microsserviços;</li><li><a href=https://github.com/spinnaker/orca>Orca</a>: Controla todas as operações e pipelines;</li><li><a href=https://github.com/spinnaker/clouddriver>Clouddriver</a>: Orquestração de clusters e containers multi <em>cloud provider</em>;</li><li><a href=https://github.com/spinnaker/front50>Front50</a>: Persistência de dados utilizando Redis, garante histórico de operações, builds, pipelines, deploys, etc;</li><li><a href=https://github.com/spinnaker/rosco>Rosco</a>: Responsável por buildar imagens vindas de diferentes serviços (como <a href=https://cloud.google.com/compute/docs/images>GCE Images</a>, <a href=https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AMIs.html>AWS AMIs</a>);</li><li><a href=https://github.com/spinnaker/rosco>Igor</a>: Fornece interface para triggers que podem ser integrados aos pipelines, possui integração com webhooks e algumas ferramentas como Jenkins e Travis;</li><li><a href=https://github.com/spinnaker/rosco>Echo</a>: Sistema de notificação;</li><li><a href=https://github.com/spinnaker/rosco>Fiat</a>: Faz o controle de acesso em um sistema baseado em RBAC - Role Based Access Control;</li><li><a href=https://github.com/spinnaker/halyard>Halyard</a>: Serviço que faz a configuração e gerenciamento do Spinnaker e seus microsserviços, permite instalar, atualizar e fazer rollbacks.</li></ul><p>Uma vantagem dessa arquitetura, é que conseguimos acessar pequenas partes do todo, com isso, facilitando integrações externas a processos que não sigam o convencional, exemplo: executar um pipeline de deploy via comando de um bot do slack.</p><h3 id=pipelines>Pipelines</h3><p>O pipeline pode ser um processo, um conjunto de processos ou um conjunto de pipelines, para ilustrar melhor visualize a imagem abaixo:</p><p><img src=/spinnaker/pipelines.jpeg alt=Pipelines></p><p>Para ativar um pipeline é necessário um trigger que pode ser um webhook ou um registry (<a href=https://docs.docker.com/registry/>the Registry is a stateless, highly scalable server side application that stores and lets you distribute Docker images</a>).</p><ul><li>Bake & Deploy to Test: Consiste em preparar o que for necessário para enviar seu <em>app</em> para o ambiente de teste;</li><li>Validate Test: Pelo fato do Spinnaker também oferecer triggers que podem ser ativados manualmente, ao enviar algo para o ambiente de QA por exemplo, você pode determinar que apenas os testadores podem validar e manualmente aprovar (podendo ser também acessado via API) o seu envio para um ambiente de homologação;</li><li>Promote to Prod: Automatizado, sem estresse, faz o deploy utilizando clusters, instâncias, kubernetes e load balancers, de acordo com a estratégia configurada, como disse anteriormente possui diferentes estratégias que são gerenciadas pela própria ferramenta.</li></ul><h2 id=portal-telemedicina>Portal Telemedicina</h2><p>Tivemos alguns desafios iniciais aqui na Portal, primeiramente precisávamos criar toda a estrutura básica de testes, checagem estática de código e formatação, depois adicionar isso aos pipelines do <a href=https://bitbucket.org>Bitbucket</a> (plataforma que atualmente usamos aqui), &ldquo;dockerizar&rdquo; as aplicações, criar a infraestrutura do Spinnaker e seus microsserviços, e por fim, o principal, integrar e juntar as pontas. Acabamos utilizando webhooks (git) entre Bitbucket e Google Cloud Registry, e um &ldquo;observador&rdquo; de imagens entre Google Cloud Registry e Spinnaker, tudo isso sobre a orquestração do git flow - com algumas adaptações.</p><p>Partimos praticamente do zero para entrega contínua em pouco mais de um mês com importância fundamental do Spinnaker, até agora os resultados foram satisfatórios, em momentos intensos de entrega, conseguimos realizar diversos deploys por dia sem downtime, diminuindo o tempo entre a entrega e o ciclo de feedback.</p></section><footer class="mt-12 flex flex-wrap"><a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=http://fguedes.xyz/fguedes.xyz/tags/integra%C3%A7%C3%A3o-cont%C3%ADnua>Integração Contínua</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=http://fguedes.xyz/fguedes.xyz/tags/deploy-cont%C3%ADnuo>Deploy Contínuo</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=http://fguedes.xyz/fguedes.xyz/tags/spinnaker>spinnaker</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=http://fguedes.xyz/fguedes.xyz/tags/docker>docker</a>
<a class="mb-1.5 mr-1.5 rounded-lg bg-black/[3%] px-5 py-1.5 no-underline dark:bg-white/[8%]" href=http://fguedes.xyz/fguedes.xyz/tags/kubernetes>kubernetes</a></footer></article></main><footer class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"><div class=mr-auto>&copy; 2023
<a class=link href=http://fguedes.xyz/fguedes.xyz/>Luís Fernando Guedes</a></div><a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>✎ Paper</a></footer></body></html>